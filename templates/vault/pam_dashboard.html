{% extends 'menshun_base.html' %}

{% block title %}PAM Dashboard - Menshun PAM{% endblock %}
{% block page_title %}PAM Dashboard{% endblock %}
{% block page_subtitle %}Privileged Account Management and Security Overview{% endblock %}

{% block header_actions %}
    <button type="button" class="btn btn-secondary" onclick="refreshPAMDashboard()">
        <i class="ph ph-arrows-clockwise"></i>
        Refresh
    </button>
{% endblock %}

{% block content %}
    <!-- Admin Account Overview Section -->
    <div style="margin-bottom: var(--space-xl);">
        <h2 style="color: var(--pure-white); font-size: 20px; font-weight: 700; margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-xs);">
            <i class="ph ph-user-gear" style="color: var(--electric-blue);"></i>
            Admin Account Overview
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md);">
            <!-- Total Admin Accounts -->
            <div class="card glow-pulse">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            TOTAL ADMIN ACCOUNTS
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--pure-white); margin-bottom: var(--space-xs);">
                            {{ admin_overview.total_accounts }}
                        </div>
                        <div style="font-size: 12px; color: var(--emerald-green); display: flex; align-items: center; gap: 4px;">
                            <i class="ph ph-shield-check"></i>
                            Managed Accounts
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--electric-blue), #0284c7); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-users-three" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- Active Accounts -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            ACTIVE ACCOUNTS
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--emerald-green); margin-bottom: var(--space-xs);">
                            {{ admin_overview.active_accounts }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            {{ admin_overview.inactive_accounts }} inactive
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--emerald-green), #059669); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-check-circle" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- Recent Activity -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            RECENT ACTIVITY
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--pure-white); margin-bottom: var(--space-xs);">
                            {{ admin_overview.recent_activity }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            Last 30 days
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--vibrant-purple), #7c3aed); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-activity" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- Risk Accounts -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            HIGH RISK ACCOUNTS
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: {% if admin_overview.high_risk_accounts > 0 %}var(--accent-orange){% else %}var(--emerald-green){% endif %}; margin-bottom: var(--space-xs);">
                            {{ admin_overview.high_risk_accounts }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            {{ admin_overview.risk_percentage }}% of total
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, {% if admin_overview.high_risk_accounts > 0 %}var(--accent-orange), #ea580c{% else %}var(--emerald-green), #059669{% endif %}); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-{% if admin_overview.high_risk_accounts > 0 %}warning{% else %}shield-check{% endif %}" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Credential Management Section -->
    <div style="margin-bottom: var(--space-xl);">
        <h2 style="color: var(--pure-white); font-size: 20px; font-weight: 700; margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-xs);">
            <i class="ph ph-key" style="color: var(--electric-blue);"></i>
            Credential Management
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--space-md);">
            <!-- Vault Compliance -->
            <div class="card">
                <div style="margin-bottom: var(--space-md);">
                    <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                        VAULT COMPLIANCE
                    </div>
                    <div style="font-size: 28px; font-weight: 800; color: var(--pure-white); margin-bottom: var(--space-xs);">
                        {{ credential_management.vault_compliance.compliance_rate }}%
                    </div>
                    <div style="font-size: 12px; color: var(--soft-grey); margin-bottom: var(--space-md);">
                        {{ credential_management.vault_compliance.with_vault_entry }} of {{ credential_management.vault_compliance.total_entries }} accounts
                    </div>
                    
                    <!-- Compliance progress bar -->
                    <div style="width: 100%; height: 8px; background: var(--charcoal-grey); border-radius: 4px; overflow: hidden;">
                        <div style="width: {{ credential_management.vault_compliance.compliance_rate }}%; height: 100%; background: linear-gradient(90deg, var(--emerald-green), var(--electric-blue)); transition: width 0.3s ease;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Password Age Analysis -->
            <div class="card">
                <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-md);">
                    PASSWORD AGE BREAKDOWN
                </div>
                
                <div style="display: flex; flex-direction: column; gap: var(--space-sm);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: var(--space-xs);">
                            <div style="width: 8px; height: 8px; background: var(--emerald-green); border-radius: 50%;"></div>
                            <span style="color: var(--pure-white); font-size: 14px;">Recent (< 30 days)</span>
                        </div>
                        <span style="color: var(--emerald-green); font-weight: 600;">{{ credential_management.password_age.recent }}</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: var(--space-xs);">
                            <div style="width: 8px; height: 8px; background: var(--accent-orange); border-radius: 50%;"></div>
                            <span style="color: var(--pure-white); font-size: 14px;">Moderate (30-90 days)</span>
                        </div>
                        <span style="color: var(--accent-orange); font-weight: 600;">{{ credential_management.password_age.moderate }}</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: var(--space-xs);">
                            <div style="width: 8px; height: 8px; background: var(--danger-red); border-radius: 50%;"></div>
                            <span style="color: var(--pure-white); font-size: 14px;">Old (> 90 days)</span>
                        </div>
                        <span style="color: var(--danger-red); font-weight: 600;">{{ credential_management.password_age.old }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Managed Credentials -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            MANAGED CREDENTIALS
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--pure-white); margin-bottom: var(--space-xs);">
                            {{ credential_management.managed_credentials }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            Total: {{ credential_management.total_credentials }}
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--vibrant-purple), #7c3aed); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-password" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Role & Permission Management Section -->
    <div style="margin-bottom: var(--space-xl);">
        <h2 style="color: var(--pure-white); font-size: 20px; font-weight: 700; margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-xs);">
            <i class="ph ph-user-gear" style="color: var(--electric-blue);"></i>
            Role & Permission Management
        </h2>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-md);">
            <!-- Total Users -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            TOTAL USERS
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--pure-white); margin-bottom: var(--space-xs);">
                            {{ role_management.total_users }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            {{ role_management.users_with_roles }} with roles
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--electric-blue), #0284c7); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-users" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- Permanent Assignments -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            PERMANENT ROLES
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--emerald-green); margin-bottom: var(--space-xs);">
                            {{ role_management.permanent_assignments }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            Always active
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--emerald-green), #059669); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-lock" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- PIM Eligible -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            PIM ELIGIBLE
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--accent-orange); margin-bottom: var(--space-xs);">
                            {{ role_management.eligible_assignments }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            Activation required
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--accent-orange), #ea580c); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-clock" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- Active PIM -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                            ACTIVE PIM
                        </div>
                        <div style="font-size: 32px; font-weight: 800; color: var(--vibrant-purple); margin-bottom: var(--space-xs);">
                            {{ role_management.active_pim_assignments }}
                        </div>
                        <div style="font-size: 12px; color: var(--soft-grey);">
                            Currently active
                        </div>
                    </div>
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--vibrant-purple), #7c3aed); border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center;">
                        <i class="ph ph-lightning" style="font-size: 24px; color: var(--pure-white);"></i>
                    </div>
                </div>
            </div>
            
            <!-- MFA Compliance -->
            <div class="card">
                <div style="margin-bottom: var(--space-md);">
                    <div style="color: var(--soft-grey); font-size: 14px; font-weight: 600; margin-bottom: var(--space-xs);">
                        MFA COMPLIANCE
                    </div>
                    <div style="font-size: 28px; font-weight: 800; color: var(--pure-white); margin-bottom: var(--space-xs);">
                        {{ role_management.mfa_compliance_rate }}%
                    </div>
                    <div style="font-size: 12px; color: var(--soft-grey); margin-bottom: var(--space-md);">
                        {{ role_management.mfa_enabled }} of {{ role_management.total_users }} users
                    </div>
                    
                    <!-- MFA compliance progress bar -->
                    <div style="width: 100%; height: 8px; background: var(--charcoal-grey); border-radius: 4px; overflow: hidden;">
                        <div style="width: {{ role_management.mfa_compliance_rate }}%; height: 100%; background: linear-gradient(90deg, var(--emerald-green), var(--electric-blue)); transition: width 0.3s ease;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Admin Entries -->
    {% if recent_admin_entries %}
    <div style="margin-bottom: var(--space-xl);">
        <h2 style="color: var(--pure-white); font-size: 20px; font-weight: 700; margin-bottom: var(--space-md); display: flex; align-items: center; gap: var(--space-xs);">
            <i class="ph ph-clock-clockwise" style="color: var(--electric-blue);"></i>
            Recent Admin Entries
        </h2>
        
        <div class="card">
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--charcoal-grey);">
                            <th style="text-align: left; padding: var(--space-sm); color: var(--soft-grey); font-weight: 600; font-size: 12px; text-transform: uppercase;">Name</th>
                            <th style="text-align: left; padding: var(--space-sm); color: var(--soft-grey); font-weight: 600; font-size: 12px; text-transform: uppercase;">Username</th>
                            <th style="text-align: left; padding: var(--space-sm); color: var(--soft-grey); font-weight: 600; font-size: 12px; text-transform: uppercase;">Type</th>
                            <th style="text-align: left; padding: var(--space-sm); color: var(--soft-grey); font-weight: 600; font-size: 12px; text-transform: uppercase;">Source</th>
                            <th style="text-align: left; padding: var(--space-sm); color: var(--soft-grey); font-weight: 600; font-size: 12px; text-transform: uppercase;">Last Updated</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for entry in recent_admin_entries %}
                        <tr style="border-bottom: 1px solid var(--dark-slate);">
                            <td style="padding: var(--space-sm); color: var(--pure-white); font-weight: 500;">{{ entry.name }}</td>
                            <td style="padding: var(--space-sm); color: var(--soft-grey);">{{ entry.username }}</td>
                            <td style="padding: var(--space-sm);">
                                <span style="display: inline-block; padding: 4px 8px; background: var(--electric-blue); color: var(--pure-white); border-radius: 4px; font-size: 12px; font-weight: 500;">
                                    {{ entry.admin_account_type|default:"Admin" }}
                                </span>
                            </td>
                            <td style="padding: var(--space-sm); color: var(--soft-grey);">{{ entry.source_integration|default:"Manual" }}</td>
                            <td style="padding: var(--space-sm); color: var(--soft-grey); font-size: 14px;">{{ entry.updated_at|date:"M d, Y" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

{% endblock %}

{% block extra_scripts %}
<script>
function refreshPAMDashboard() {
    location.reload();
}

// Auto-refresh every 5 minutes
setInterval(refreshPAMDashboard, 300000);
</script>
{% endblock %}